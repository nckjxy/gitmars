#!/usr/bin/env node
"use strict";const{program:e}=require("commander"),t=require("shelljs"),{options:r,args:i}=require("./conf/start"),{error:s,success:o,queue:u,getStatus:c,isGitProject:g}=require("./js/index"),{createArgs:n}=require("./js/tools");g()||(t.echo(s("当前目录不是git项目目录")),t.exit(1));const a=require("./js/getConfig")();e.name("gitm start").usage("<type> <name>").description("创建bugfix任务分支、创建feature功能开发分支、support框架支持分支"),i.length>0&&e.arguments(n(i)),r.forEach((t=>{e.option(t.flags,t.description,t.defaultValue)})),e.action(((e,r)=>{const i=["bugfix","feature","support"];if(c()||t.exit(1),i.includes(e)){const i="bugfix"===e?a.bugfix:"support"===e?a.master:a.release;u(["git fetch",`git checkout ${i}`,"git pull",`git checkout -b ${e}/${r} ${i}`]).then((s=>{0===s[3].code&&t.echo(`${r}分支创建成功，该分支基于${i}创建，您当前已经切换到${e}/${r}\n如果需要提测，请执行${o("gitm combine "+e+" "+r)}\n开发完成后，记得执行: ${o("gitm end "+e+" "+r)}`)}))}else t.echo(s("type只允许输入："+JSON.stringify(i))),t.exit(1)})),e.parse(process.argv);
