#!/usr/bin/env node
"use strict";"undefined"!=typeof require&&require;const{program:e}=require("commander"),n=require("shelljs"),a=require("inquirer"),{options:r,args:m}=require("./conf/go"),{combine:o,end:t,update:c,build:i,start:d,admin:s,branch:u,copy:p,get:l,save:g,revert:h,link:v,unlink:b,postmsg:q}=require("./js/go/index"),{success:f,getCurrent:y}=require("./js/index"),{createArgs:x}=require("./js/tools");e.name("gitm go").usage("[command]").description("智能猜测你要执行的动作"),m.length>0&&e.arguments(x(m)),r.forEach((n=>{e.option(n.flags,n.description,n.defaultValue)})),e.action((()=>{return e=void 0,r=null,m=function*(){const e=y();n.echo(f(`当前分支${e}，系统猜测你可能想做以下操作：`)),a.prompt({type:"list",name:"command",message:"请选择你想要的操作?",default:"combine",choices:[new a.Separator(" === 1. Gitmars工作流 === "),"combine","end","update","build","start","admin.publish","admin.update","admin.create","admin.clean",new a.Separator(" === 2. 高级工具 === "),"branch","copy","get","save","revert","link","unlink","postmsg",new a.Separator(" === 退出 === "),"exit",new a.Separator],filter:e=>e}).then((e=>{"exit"===e.command&&(n.echo(f("已退出")),n.exit(0)),n.echo(f(`你选择了${e.command}指令`)),"combine"===e.command?o():"end"===e.command?(n.echo("注意end指令会在执行合并代码到dev和预发之后删除分支"),t()):"update"===e.command?c():"build"===e.command?i():"start"===e.command?d():"admin.publish"===e.command?s.publish():"admin.update"===e.command?s.update():"admin.create"===e.command?s.create():"admin.clean"===e.command?s.clean():"branch"===e.command?u():"copy"===e.command?p():"get"===e.command?l():"save"===e.command?g():"revert"===e.command?h():"link"===e.command?v():"unlink"===e.command?b():"postmsg"===e.command&&q()}))},new Promise(((n,a)=>{var o=e=>{try{c(m.next(e))}catch(e){a(e)}},t=e=>{try{c(m.throw(e))}catch(e){a(e)}},c=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,t);c((m=m.apply(e,r)).next())}));var e,r,m})),e.parse(process.argv);
