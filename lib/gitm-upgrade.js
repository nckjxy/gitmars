#!/usr/bin/env node
"use strict";var r=require("commander"),e=require("child_process"),s=require("shelljs");require("fs");var t=require("colors");require("slash"),require("cosmiconfig");var i=require("ora");function n(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var o=n(s),a=n(t),c=n(i);function l(r){return a.default.green(r)}r.program.name("gitm upgrade").usage("[version]").description("升级gitmars").arguments("[version]").option("-m, --mirror","是否使用淘宝镜像",!1).action((async(r,s)=>{const t=c.default(l("正在安装请稍后")).start();let i=r&&r.match(/[0-9.]+$/)||null,n=["npm",["install","-g",`gitmars@${i?i[0]:"latest"}`]],a=["npm",["uninstall","-g","gitmars"]];s.mirror&&(n[1]=n[1].concat(["-registry","https://registry.npm.taobao.org"]));0===e.spawnSync(a[0],a[1],{stdio:"inherit",shell:"win32"===process.platform}).status&&(console.warn("安装出错了"),process.exit(0));const p=e.spawnSync(n[0],n[1],{stdio:"inherit",shell:"win32"===process.platform});e.spawnSync("gitm",["-v"],{stdio:"inherit",shell:"win32"===process.platform}),o.default.echo(`\n${l("安装完成")}`),t.stop(),0===p.status||console.warn("安装出错了"),process.exit(0)})),r.program.parse(process.argv);
