#!/usr/bin/env node
"use strict";const{program:s}=require("commander"),{spawnSync:r}=require("child_process"),e=require("shelljs"),{success:t}=require("./js/index"),i=require("ora");s.name("gitm upgrade").usage("[version]").description("升级gitmars").arguments("[version]").option("-m, --mirror","是否使用淘宝镜像",!1).action((async(s,o)=>{const n=i(t("正在安装请稍后")).start();let a=s&&s.match(/[0-9.]+$/)||null,c=["npm",["install","-g",`gitmars@${a?a[0]:"latest"}`]],l=["npm",["uninstall","-g","gitmars"]];o.mirror&&(c[1]=c[1].concat(["-registry","https://registry.npm.taobao.org"]));0===r(l[0],l[1],{stdio:"inherit",shell:"win32"===process.platform}).status&&(console.warn("安装出错了"),process.exit(0));const p=r(c[0],c[1],{stdio:"inherit",shell:"win32"===process.platform});r("gitm",["-v"],{stdio:"inherit",shell:"win32"===process.platform}),e.echo(`\n${t("安装完成")}`),n.stop(),0===p.status||console.warn("安装出错了"),process.exit(0)})),s.parse(process.argv);
