#!/usr/bin/env node
"use strict";"undefined"!=typeof require&&require;const{program:e}=require("commander"),{spawnSync:r}=require("child_process"),s=require("shelljs"),{options:t,args:o}=require("./conf/upgrade"),{success:i}=require("./js/index"),{createArgs:n}=require("./js/tools"),a=require("ora");e.name("gitm upgrade").usage("[version]").description("升级gitmars"),o.length>0&&e.arguments(n(o)),t.forEach((r=>{e.option(r.flags,r.description,r.defaultValue)})),e.action(((e,t)=>{return o=void 0,n=null,c=function*(){const o=a(i("正在安装请稍后")).start(),n=e&&e.match(/[0-9.]+$/)||null,c=["npm",["install","-g",`gitmars@${n?n[0]:"latest"}`]],l=["npm",["uninstall","-g","gitmars"]];t.mirror&&(c[1]=c[1].concat(["-registry","https://registry.npm.taobao.org"])),0!==r(l[0],l[1],{stdio:"inherit",shell:"win32"===process.platform}).status&&(console.warn("卸载出错了"),process.exit(0));const p=r(c[0],c[1],{stdio:"inherit",shell:"win32"===process.platform});r("gitm",["-v"],{stdio:"inherit",shell:"win32"===process.platform}),s.echo(`\n${i("安装完成")}`),o.stop(),0===p.status||console.warn("安装出错了"),process.exit(0)},new Promise(((e,r)=>{var s=e=>{try{i(c.next(e))}catch(e){r(e)}},t=e=>{try{i(c.throw(e))}catch(e){r(e)}},i=r=>r.done?e(r.value):Promise.resolve(r.value).then(s,t);i((c=c.apply(o,n)).next())}));var o,n,c})),e.parse(process.argv);
