#!/usr/bin/env node
const program=require("commander");const sh=require("shelljs");const{error,getCurrent}=require("./js/index");const config=require("./js/getConfig")();program.name("gitm permission").usage("[message]").arguments("[message]").description("校验提交权限").option("--no-verify","是否需要跳过校验权限",false).option("--dev","是否限制dev提交",false).option("--release","是否限制release提交",false).action((message,opt)=>{console.log("gitm permission is running");const current=getCurrent();let allow=[config.master],msg=sh.exec("git show",{silent:true}).stdout,index;if(opt.dev)allow.push(config.develop);if(opt.release)allow.push(config.release);index=allow.indexOf(current);if(index>-1&&!opt.noVerify&&msg&&msg.indexOf("Merge:")===-1&&msg.indexOf("Merge branch")===-1){sh.echo(error(`${allow[index]}\u5206\u652F\u4E0D\u5141\u8BB8\u76F4\u63A5\u63D0\u4EA4`));sh.exit(1)}else{sh.exit(0)}});program.parse(process.argv);