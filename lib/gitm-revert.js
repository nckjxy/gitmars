#!/usr/bin/env node
const program=require("commander");const sh=require("shelljs");const{options,args}=require("./conf/revert");const{warning,queue}=require("./js/index");const{createArgs}=require("./js/tools");program.name("gitm revert").usage("[commitid] [-n --number [number]] [-m --mode [mode]]").description("撤销一次提交记录");if(args.length>0)program.arguments(createArgs(args));options.forEach(o=>{program.option(o.flags,o.description,o.defaultValue)});program.action((commitid,opt)=>{let cmd=[],n="HEAD",m="";if(opt.mode)m=" -m "+Math.abs(Number(opt.mode));if(opt.number){let num=Math.abs(Number(opt.number));if(num>1)n+="~"+(num-1);cmd.push({cmd:`git revert ${n}${m}`,config:{slient:false,again:true,success:"撤销成功",fail:"出错了，请根据提示处理"}})}else if(commitid){cmd.push({cmd:`git revert ${commitid}${m}`,config:{slient:false,again:true,success:"撤销成功",fail:"出错了，请根据提示处理"}})}else{sh.echo(warning("指令不合法"));sh.exit(1)}queue(cmd)});program.parse(process.argv);