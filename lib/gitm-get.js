#!/usr/bin/env node
const program=require("commander");const sh=require("shelljs");const{options,args}=require("./conf/get");const{queue,getCurrent,getStashList,warning}=require("./js/index");const{createArgs}=require("./js/tools");program.name("gitm get").usage("[message] [index]").description("恢复暂存区文件");if(args.length>0)program.arguments(createArgs(args));options.forEach(o=>{program.option(o.flags,o.description,o.defaultValue)});program.action(async(message,index,opt)=>{if(!message)message=getCurrent();let list=await getStashList(message);if(list.length===0)sh.echo(warning(`\u8BE5\u5206\u652F\u6CA1\u6709\u6682\u5B58\u4EFB\u4F55\u6587\u4EF6\uFF01`));if(index===void 0&&list.length>1)sh.echo(warning(`\u8BE5\u5206\u652F\u4E0B\u6709${list.length}\u6761\u6682\u5B58\u8BB0\u5F55\uFF0C\u9ED8\u8BA4\u6062\u590D\u6700\u8FD1\u7684\u4E00\u6761\u8BB0\u5F55`));if(list.length>2)sh.echo(warning(`\u8BE5\u5206\u652F\u4E0B\u6709${list.length}\u6761\u6682\u5B58\u8BB0\u5F55\uFF0C\u5EFA\u8BAE\u5B9A\u671F\u6E05\u7406\u4E0D\u5FC5\u8981\u7684\u6682\u5B58\u8BB0\u5F55\uFF01`));queue([{cmd:`git stash ${opt.keep?"apply":"pop"} ${list[index||0].key}`,config:{again:opt.keep?false:`git stash drop ${list[index||0].key}`,success:"文件恢复成功",fail:"恢复失败，请检查冲突"}}])});program.parse(process.argv);