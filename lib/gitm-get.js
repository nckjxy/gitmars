#!/usr/bin/env node
"use strict";const{program:e}=require("commander"),t=require("shelljs"),{options:r,args:s}=require("./conf/get"),{error:i,queue:a,getCurrent:g,getStashList:o,warning:n,isGitProject:c}=require("./js/index"),{createArgs:h}=require("./js/tools");c()||(t.echo(i("当前目录不是git项目目录")),t.exit(1)),e.name("gitm get").usage("[message] [index]").description("恢复暂存区文件"),s.length>0&&e.arguments(h(s)),r.forEach((t=>{e.option(t.flags,t.description,t.defaultValue)})),e.action((async(e,r,s)=>{e||(e=g());let i=await o(e);0===i.length&&t.echo(n("该分支没有暂存任何文件！")),void 0===r&&i.length>1&&t.echo(n(`该分支下有${i.length}条暂存记录，默认恢复最近的一条记录`)),i.length>2&&t.echo(n(`该分支下有${i.length}条暂存记录，建议定期清理不必要的暂存记录！`)),a([{cmd:`git stash ${s.keep?"apply":"pop"} ${i[r||0].key}`,config:{again:!s.keep&&`git stash drop ${i[r||0].key}`,success:"文件恢复成功",fail:"恢复失败，请检查冲突"}}])})),e.parse(process.argv);
