"use strict";"undefined"!=typeof require&&require;var e=(e,t,r)=>new Promise(((i,n)=>{var o=e=>{try{p(r.next(e))}catch(e){n(e)}},s=e=>{try{p(r.throw(e))}catch(e){n(e)}},p=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);p((r=r.apply(e,t)).next())}));const t=require("shelljs"),r=require("./apollo"),{error:i,success:n,mapTemplate:o}=require("./index");module.exports=function(s){return e(this,arguments,(function*({env:e,project:s,app:p="all"}){const a=yield r(),l=a[e];let c;if(!l)return t.echo(i("请输入正确的环境名称")),void t.exit(1);if(c=l.list.find((e=>e.name===s)),!c)return t.echo(i("请输入正确的项目名称")),void t.exit(1);if(p&&c.apps&&!c.apps.includes(p))return t.echo(i("请输入正确的应用名称")),void t.exit(1);if(!a.template)return t.echo(i("请配置Jenkins构建地址模板")),void t.exit(1);const u=o(c.apps&&c.apps.length>0?a.templateWithParam:a.template,{line:l.line,project:c.project,token:l.token,app:p});t.exec(`curl -u ${a.username}:${a.password} "${u}"`,{silent:!0}),t.echo(n("成功调起Jenkins构建"))}))};
