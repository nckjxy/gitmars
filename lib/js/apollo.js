let apollo=require("node-apollo"),path=require("path"),fs=require("fs"),sh=require("shelljs");const{error,writeFile}=require("./index");const{gitDir}=require("./gitRevParse")();const getConfig=require("./getConfig");module.exports=async function apolloConfig(){let now=(new Date).getTime(),config,apolloConfig2,result;if(sh.test("-f",gitDir+"/buildConfig.json")){let fileDate=parseInt(sh.cat(gitDir+"/buildConfig.txt").stdout);if(now-fileDate<24*60*60*1e3)return require(gitDir+"/buildConfig.json")}config=getConfig();if(!config.apolloConfig){sh.echo(error("请配置apollo"));sh.exit(0);return}try{apolloConfig2=JSON.parse(config.apolloConfig)}catch(err){apolloConfig2=config.apolloConfig}result=await apollo.remoteConfigService(apolloConfig2);await writeFile(gitDir+"/buildConfig.txt",String(now));await writeFile(gitDir+"/buildConfig.json",JSON.stringify(result.content));return result.content};