"use strict";const e=require("path");let i=require("node-apollo"),t=require("shelljs");const{error:o,writeFile:n}=require("./index"),r=require("./getConfig");module.exports=async function(){const l=e.join(__dirname,"../../cache");let a,f,s,u=(new Date).getTime();if(t.test("-f",l+"/buildConfig.json")){if(u-parseInt(t.cat(l+"/buildConfig.txt").stdout)<864e5)return require(l+"/buildConfig.json")}if(a=r(),!a.apolloConfig)return t.echo(o("请配置apollo")),void t.exit(0);if("string"==typeof a.apolloConfig)try{f=JSON.parse(a.apolloConfig)}catch{return}else f=a.apolloConfig;return s=await i.remoteConfigService(f),await n(l+"/buildConfig.txt",String(u)),await n(l+"/buildConfig.json",JSON.stringify(s.content)),s.content};
